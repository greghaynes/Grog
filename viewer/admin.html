<html>
<head>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script type="text/javascript" src="grogadmin.js"></script>
	<script type="text/javascript" src="grog.js"></script>

	<style type="text/css">
	body {
		font-family: sans-serif;
	}

	#logindiv {
		position: absolute;
		left: 50%;
		top: 100px;
		margin-left: -150px;
		width: 300px;
		opacity: 0;
	}

	#container {
		opacity: 0;
	}

	#navigation {
		float: left;
		list-style-type: none;
		margin: 0;
		padding: 10px;
	}

	#entrylist {
	}
	</style>
</head>

<body>

<div id="logindiv">
	<h3>Please login</h3>
	Username: <input type="text" id="username"/><br />
	Password: <input type="password" id="password"/><br />
	<button id="login_button">Login</button><br />
	<span id="logindiv_errmsg"></span>
</div>

<div id="container">
	<ul id="navigation">
		<li><a href="#entries" id="entries">Entries</a></li>
		<li><a href="#settings">Settings</a></li>
		<li><a href="#logout" id="logout">Log Out</a></li>
	</ul>

	<div id="content">
	</div>
</div>

<script type="text/javascript">
	// Login dialog
	function login_dialog_hide() {
		$("#logindiv").animate({opacity: 0});
	}

	function login_dialog_show() {
		$("#logindiv").animate({opacity: '100%'});
	}

	function login_dialog_display_error(error) {
		if('type' in error) {
			if(error.type == 'Not Found')
				$("#logindiv_errmsg").html("Username or password incorrect.");
			else
				$("#logindiv_errmsg").html(error.type);
		} else {
			$("#logindiv_errmsg").html("Undefined error.");
		}
	}

	// content
	function clear_content() {
		$("#content").html("");
	}

	function page_hide() {
		$("#container").animate({opacity: 0});
	}

	function page_show() {
		$("#container").animate({opacity: '100%'});
	}

	function entry_show(entry_id) {
		clear_content();

		grog.getEntry(entry_id, function(entry) {
			edit_div = $("<div id=\"entry_edit\"></div>");
			$("<h3>"+entry.title+"</h3>").appendTo(edit_div);
			$("<p>"+entry.content+"</p>").appendTo(edit_div);
			edit_div.appendTo("#content");
		});
	}

	function create_entry_show() {
	}

	function entries_show() {
		clear_content();

		$("<a href=\"#create_entry\">Create entry</a>").appendTo("#content");
		$("#create_entry").click(function(event) { create_entry_show(); });

		$("<ul id=\"entrylist\"></ul>").appendTo("#content");

		// load entry list
		grog.getLatestEntries(function(data) {
			if(data.length == 0)
				$("<li>There are currently no entries.</li>").appendTo("#entrylist");
			else {
				$.each(data, function(ndx, entry) {
					$("<li id=\"entry_"+entry.id+"\">"+entry.title+" <a href=\"#edit_"+entry.id+"\" id=\"edit_"+entry.id+"\">edit</a></li>").appendTo("#entrylist");
					$("#edit_"+entry.id).click(function(event) { entry_show(entry.id); });
				});
			}
		});
	}

	function entries_hide() {
		$("#entrylist").animate({opacity: 0});
	}

	function do_login(username, password) {
		console.log("logging in as "+username+" "+password);
		grogadmin.login(username, password, function(data) {
			if(grogadmin.is_logged_in) {
				login_dialog_hide();
				page_show();
			}
			else
				login_dialog_display_error(data);
		});
	}

	// Setup handlers
	$("#login_button").click(function(event) {
		do_login($("#username").val(), $("#password").val());
	});

	$("#logout").click(function(event) { 
		grogadmin.logout(function(data) {
			page_hide();
			login_dialog_show();
		})
	});

	$("#entries").click(function(event) {
		entries_show();
	});

	// Check current login or show login dialog
	grogadmin.check_login(function(data) {
		if(!grogadmin.is_logged_in)
			login_dialog_show();
		else
			page_show();
	});

</script>

</body>

</html>
